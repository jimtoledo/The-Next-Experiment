pico-8 cartridge // http://www.pico-8.com
version 18
__lua__
function _init()
	--map sprites
	mp = {}
	mp.blank = 1
	mp.puzzle = 2
	mp.collect = 3
	mp.ent = 4
	
	--num of puzzles and collectables
	num_puz = 4
	num_col = 2
	
	-- board size will be 16x16
	n= 16
	board = 0
	
	--player information
	player ={}
	player.x = 0
	player.y =	0
	player.spr =16
	
	-- scene controller
	game_scene = "play"
	
	board,player.x,player.y = setupboard()	
end

function _update()
	if btnp(0,0) then 
		player.y-= 1
	elseif btnp(1,0) then 
		player.y+= 1
	elseif btnp(2,0) then 
		player.x-= 1 
	elseif btnp(3,0) then 
		player.x+= 1 
	end
end

function _draw()
	draw_play_map(player.x,player.y,board)
end
-->8
function setupboard()
	l = {}
	for i=1, n do
		l[i] = {}
		for j=1, n do
			l[i][j]= 0
		end
	end
	
	--randomly populate puzzle locations
	for i=1, num_puz do
		x = flr(rnd(n-1))+1
		y = flr(rnd(n-1))+1
		while (l[x][y] != 0 ) do
			x = flr(rnd(n-1))+1
			y = flr(rnd(n-1))+1
		end
		l[x][y] ='p'
	end
	
	--randomly populate collectables locations
	for i=1, num_col do
		x = flr(rnd(n-1))+1
		y = flr(rnd(n-1))+1
		while (l[x][y] != 0 ) do
			x = flr(rnd(n-1))+1
			y = flr(rnd(n-1))+1
		end
		l[x][y] ='c'
	end
	
		--place the entrance, updating playerx and player y value
	flag= true
	while flag do
		x = flr(rnd(n-1))+1
		y = flr(rnd(n-1))+1
		if l[x][y] == 0 then
			l[x][y] = 'e'
			playerx = x
			playery = y
			flag = false
		end
	end
	return l, playerx, playery
end

function draw_play_map(px,py,l)
	cls()
	x =64-((#l/2)*8)
 y = 0
 for i=1,#l do
 	for j=1,#l do
 		if i == px and j== py then
 			spr(player.spr,x,y)
 		elseif l[i][j] == 0 then
 			spr(mp.blank,x,y)
			elseif l[i][j] == 'p' then
				spr(mp.puzzle,x,y)
			elseif l[i][j] == 'c' then
				spr(mp.collect,x,y)
			elseif l[i][j] == 'e' then
				spr(mp.ent,x,y)
 		end
 		x+= 8
 	end
 	x =64-((#l/2)*8)
 	y+= 8
 end
end
__gfx__
00000000666666666666666666666666666666660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000666666666611116666111166661111660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700666666666616616666166166661666660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000666666666616616666166666661116660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000666666666611116666166666661666660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700666666666616666666166166661666660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000666666666616666666111166661111660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000666666666666666666666666666666660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22222222000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22222222000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22555522000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22555522000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22555522000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22555522000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22222222000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22222222000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
